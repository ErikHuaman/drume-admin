<div class="container-fluid py-2 py-md-2">

  <div class="d-flex justify-content-between mb-4">
    <div>
      <span class="p-input-icon-right">
        <i class="fas fa-times pointer" (click)="limpiar()"></i>
        <input pInputText type="text" class="p-inputtext-sm rounded-0 rounded-start" placeholder="Número de pedido"
          [(ngModel)]="nameSearch" />
      </span>
      <button pButton class="p-button-sm btn-gray-700 rounded-0 rounded-end" icon="fas fa-magnifying-glass"
        (click)="buscar()"></button>
    </div>
    <!-- <div>
      <button pButton class="p-button-sm btn-gray-700" icon="fas fa-plus" (click)="newRegister()"
        label="Nuevo Producto"></button>
    </div> -->
  </div>

  <div class="overflow-hidden">
    <p-table styleClass="w-100 p-datatable-sm p-datatable-gridlines p-datatable-striped table-thead-dark"
      [responsive]="true" responsiveLayout="scroll" [value]="this.data">

      <ng-template pTemplate="header">
        <tr>
          <th class="text-center" style="width: 6rem !important;">N° Pedido</th>
          <th class="text-center" style="width: 8rem !important;">Fecha</th>
          <th class="text-center">Datos de cliente</th>
          <th class="text-center">Datos de pedido</th>
          <th class="text-center" style="width: 14rem !important;">Resumen de pago</th>
          <th class="text-center">Comprobante</th>
          <th class="text-center">Estado</th>
          <th class="text-center" style="width: 8rem !important;">Opciones</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-item>
        <tr>
          <td class="text-center">{{ this.setPad(item.id, 4) }}</td>
          <td class="text-center">{{ item.createdAt | date:'yyyy/MM/dd' }}</td>
          <td class="text-left">
            <p class="m-0">{{ item.info.name }} {{ item.info.lastName }}</p>
            <p class="m-0">{{ item.info.docType }}: {{ item.info.dni }}</p>
            <ng-container *ngIf="item.shipMethod == 'delivery'">
              <p class="m-0">
                {{item.info.address}}, {{item.info.city.name}}
              </p>
              <p class="m-0">
                {{item.info.city.province}}, {{item.info.city.region}}
              </p>
            </ng-container>
          </td>
          <td class="text-center text-capitalize">
            <label class="fw-bolder">Médodo de envío</label>
            <p class="m-0">
              {{ item.shipMethod == 'delivery' ? 'Olva Courier' : 'Recojo en almacén' }}
            </p>
            <label class="fw-bolder">Método de pago</label>
            <p class="m-0">
              {{ item.payMethod == 'deposito' ? 'Transferencia' : item.payCode }}
            </p>
          </td>
          <td class="text-center text-capitalize" style="width: 14rem !important;">
            <ul class="m-0 px-0 py-2">
              <li class="m-0 d-flex justify-content-between">
                <span>Subtotal</span><span>{{item.subtotal | currency:'S/ '}}</span>
              </li>
              <li class="m-0 d-flex justify-content-between">
                <span>Envío</span><span>{{item.shipment | currency:'S/ '}}</span>
              </li>
              <li class="m-0 d-flex justify-content-between">
                <span>Descuento</span>
                <span>- {{item.subtotal - item.total | currency:'S/ '}}</span>
              </li>
              <!-- <li *ngIf="item.discounts.length > 0" class="m-0 d-flex flex-column justify-content-end">
                <h6 class="w-100 d-flex justify-content-end">Descuentos incluidos</h6>
                <div *ngFor="let item of item.discounts" class="m-0 d-flex justify-content-between text-uppercase">
                  <span>{{item.name}}</span>
                  <span>- {{item.value | currency:'S/ '}}</span>
                </div>
              </li> -->
              <li class="m-0 d-flex justify-content-between fw-semibold border-top">
                <span>Total </span>
                <span>{{ item.total + item.shipment | currency:'S/ '}}</span>
              </li>
            </ul>
          </td>
          <td>
            <div class="d-flex justify-content-center">
              <comprobante-drume [hash]="item.hash"></comprobante-drume>
            </div>
          </td>
          <td class="text-center">
            <p class="m-0 rounded-4 bg-info" [ngClass]="{ 'bg-warning' : item.stateId == 3 }">
              {{ item.state.label }}
            </p>
          </td>
          <td class="text-center">
            <div class="d-flex justify-content-center">
              <button pButton pRipple icon="pi pi-window-maximize" class="btn btn-circle-xs p-button-success mx-1"
                pTooltip="Confirmar" tooltipPosition="top" (click)="editItem(item)"></button>
              <button pButton pRipple icon="pi pi-times" class="btn btn-circle-xs p-button-danger mx-1"
                pTooltip="Rechazar" tooltipPosition="top" (click)="declineItem(item)"></button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td class="text-center" colspan="100">
            No se encontró resultados
          </td>
        </tr>
      </ng-template>

    </p-table>

    <paginator-drume [(ngModel)]="paginadorValue" [rowsPerPageOptions]="[10, 25, 50, 100]"
      (change)="this.getData()"></paginator-drume>

  </div>

</div>